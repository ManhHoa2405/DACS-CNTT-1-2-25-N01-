<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Đặt lại mật khẩu</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" th:href="@{/css/reset.css}" />
    <link rel="stylesheet" th:href="@{/css/user.css}" />
    <link rel="stylesheet" th:href="@{/css/account.css}" />
  </head>
  <body>
    <header class="header">
      <div class="banner"><p>Miễn phí vận chuyển cho mọi đơn hàng</p></div>
      <nav class="navbar">
        <a th:href="@{/user/homePage}" title="Trang chủ"
          ><img th:src="@{/img/Logo.svg}" alt="Modimal"
        /></a>
        <ul class="nav-products">
          <li><a href="#">Áo</a></li>
          <li><a href="#">Quần</a></li>
          <li><a href="#">Đầm</a></li>
          <li><a href="#">Chân váy</a></li>
          <li><a href="#">Phụ kiện</a></li>
        </ul>
        <div class="actions">
          <div class="search-box">
            <a href="#"><img th:src="@{/img/Search_light.svg}" /></a>
          </div>
          <div class="account">
            <a th:href="@{/account/login}"
              ><img th:src="@{/img/Header profile icon.svg}"
            /></a>
          </div>
          <div class="cart">
            <a href="#"><img th:src="@{/img/Header bag icon.svg}" /></a>
          </div>
        </div>
      </nav>
    </header>

    <main>
      <div class="content">
        <div class="register-image">
          <img th:src="@{/img/Frame 26086866.png}" alt="Poster" />
        </div>
        <div class="register-box">
          <h2>Mật khẩu mới</h2>
          <p
            style="
              text-align: center;
              margin-bottom: 25px;
              color: #666;
              font-size: 1.5rem;
            "
          >
            Nhập mã xác nhận 6 số từ email của bạn
          </p>

          <div
            th:if="${error}"
            style="
              color: red;
              text-align: center;
              margin-bottom: 15px;
              font-weight: 500;
            "
          >
            <span th:text="${error}"></span>
          </div>

          <form
            id="reset-form"
            method="post"
            th:action="@{/account/reset-password}"
          >
            <div class="otp-container">
              <input type="number" class="otp-input" maxlength="1" required />
              <input type="number" class="otp-input" maxlength="1" required />
              <input type="number" class="otp-input" maxlength="1" required />
              <input type="number" class="otp-input" maxlength="1" required />
              <input type="number" class="otp-input" maxlength="1" required />
              <input type="number" class="otp-input" maxlength="1" required />
            </div>

            <input type="hidden" name="otp" id="hidden-otp" required />

            <input
              type="password"
              name="password"
              placeholder="Mật khẩu mới"
              required
            />
            <input
              type="password"
              name="confirmPassword"
              placeholder="Nhập lại mật khẩu mới"
              required
            />

            <button type="submit" style="margin-top: 25px">
              Xác nhận & Đăng nhập
            </button>
          </form>
        </div>
      </div>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const otpInputs = document.querySelectorAll(".otp-input");
        const hiddenOtpInput = document.getElementById("hidden-otp");
        const form = document.getElementById("reset-form");

        otpInputs.forEach((input, index) => {
          // Xử lý khi nhập số (tự động nhảy sang ô tiếp theo)
          input.addEventListener("input", function (e) {
            // Chỉ cho phép nhập 1 số
            if (this.value.length > 1) {
              this.value = this.value.slice(0, 1);
            }
            if (this.value !== "" && index < otpInputs.length - 1) {
              otpInputs[index + 1].focus();
            }
          });

          // Xử lý khi nhấn phím Backspace (xóa và lùi lại ô trước đó)
          input.addEventListener("keydown", function (e) {
            if (e.key === "Backspace" && this.value === "" && index > 0) {
              otpInputs[index - 1].focus();
            }
          });

          // Xử lý khi người dùng Copy/Paste nguyên dải 6 số vào ô đầu tiên
          input.addEventListener("paste", function (e) {
            e.preventDefault();
            const pastedData = e.clipboardData.getData("text").trim();
            // Lọc chỉ lấy số, tối đa 6 ký tự
            const numbersOnly = pastedData.replace(/[^0-9]/g, "").slice(0, 6);

            for (let i = 0; i < numbersOnly.length; i++) {
              if (otpInputs[i]) {
                otpInputs[i].value = numbersOnly[i];
                if (i < otpInputs.length - 1) {
                  otpInputs[i + 1].focus();
                } else {
                  otpInputs[i].blur();
                }
              }
            }
          });
        });

        // Xử lý khi ấn nút Submit (Ghép 6 số lại thành chuỗi)
        form.addEventListener("submit", function (e) {
          let finalOtp = "";
          otpInputs.forEach((input) => {
            finalOtp += input.value;
          });

          if (finalOtp.length === 6) {
            hiddenOtpInput.value = finalOtp;
          } else {
            e.preventDefault(); // Chặn gửi form nếu chưa nhập đủ
            alert("Vui lòng nhập đầy đủ mã xác nhận 6 số.");
          }
        });
      });
    </script>
  </body>
</html>
