<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản lý khách hàng</title>

    <!-- Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/reset.css}" />
    <link rel="stylesheet" th:href="@{/css/admin.css}" />
    <link rel="stylesheet" th:href="@{/css/manageCustomer.css}" />
  </head>

  <body>
    <div class="content">
      <!-- Left content -->
      <div class="left-content">
        <h1>ADMIN CONTROL</h1>
        <div class="divider"></div>

        <nav class="side-bar">
          <ul>
            <li>
              <a th:href="@{/admin/dashboard}">
                <img th:src="@{/img/Subtract.svg}" /> Tổng quan
              </a>
            </li>

            <li>
              <a th:href="@{/admin/addProduct}">
                <img th:src="@{/img/add-icon.svg}" /> Thêm sản phẩm
              </a>
            </li>

            <li>
              <a th:href="@{/admin/manageProduct}">
                <img th:src="@{/img/manage-product.svg}" /> Quản lý sản phẩm
              </a>
            </li>

            <li>
              <a th:href="@{/admin/manageOrder}">
                <img th:src="@{/img/manage-order.svg}" /> Quản lý đơn hàng
              </a>
            </li>

            <li class="active">
              <a th:href="@{/admin/manageCustomer}">
                <img th:src="@{/img/customer.svg}" /> Khách hàng
              </a>
            </li>
          </ul>
        </nav>
      </div>

      <!-- Right content -->
      <div class="right-content">
        <h1>Quản Lý Khách Hàng</h1>

        <!-- STAT -->
        <div class="stat-box">
          <div class="stat-card blue">
              <div class="stat-number" th:text="${totalUsers}">0</div>
              <div class="stat-label">Tổng Người Dùng</div>
          </div>

          <div class="stat-card green">
              <div class="stat-number" th:text="${buyerUsers}">0</div>
              <div class="stat-label">Người Mua</div>
          </div>
        </div>

        <!-- SEARCH -->
        <div class="search-bar">
          <input
            type="text"
            id="searchInput"
            placeholder="Tìm Kiếm Tên Khách Hàng ..."
          />
          <button id="btnSearch">Tìm Kiếm</button>
        </div>

        <!-- TABLE -->
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Thông Tin Cá Nhân</th>
                <th>Liên Hệ</th>
                <th>Đơn Hàng</th>
                <th>Ngày Đăng Ký</th>
              </tr>
            </thead>
            <tbody id="customerTable">
                <tr th:if="${customers == null or customers.empty}">
                    <td colspan="5" style="text-align: center;">Không tìm thấy dữ liệu</td>
                </tr>

                <tr th:each="user : ${customers}">
                    <td th:text="${user.id}"></td>
                    <td>
                        <div class="personal" th:text="${user.name}"></div>
                        <div class="email" th:text="${user.email}"></div>
                    </td>
                    <td th:text="${user.phone}"></td>
                    
                    <td class="order" th:text="${user.orders != null ? user.orders.size() : 0}"></td>
                    
                    <td th:text="${#temporals.format(user.createdAt, 'dd/MM/yyyy')}"></td>
                </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Lấy dữ liệu người dùng từ database -->
    <script>
    document.addEventListener("DOMContentLoaded", () => {
    const btnSearch = document.getElementById("btnSearch");
    const searchInput = document.getElementById("searchInput");

    // Xử lý sự kiện click nút Tìm kiếm
    if (btnSearch && searchInput) {
      btnSearch.addEventListener("click", () => {
        const keyword = searchInput.value.trim();
        // Chuyển hướng trang web, gửi từ khóa lên URL để Server xử lý
        // Ví dụ: /admin/manageCustomer?keyword=Nguyen
        window.location.href = `/admin/manageCustomer?keyword=${encodeURIComponent(keyword)}`;
      });
      
      // (Tùy chọn) Cho phép nhấn Enter để tìm
      searchInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
           btnSearch.click();
        }
      });
    }
  });
</script>
<tbody id="customerTable">
    <tr th:if="${customers == null or customers.empty}">
        <td colspan="5" style="text-align: center;">Không tìm thấy dữ liệu</td>
    </tr>

    <tr th:each="user : ${customers}">
        <td th:text="${user.id}"></td>
        <td>
            <div class="personal" th:text="${user.name}"></div>
            <div class="email" th:text="${user.email}"></div>
        </td>
        <td th:text="${user.phone}"></td>
        
        <td class="order" th:text="${user.orders != null ? user.orders.size() : 0}"></td>
        
        <td th:text="${#temporals.format(user.createdAt, 'dd/MM/yyyy')}"></td>
    </tr>
</tbody>

    <!-- Sidebar JS -->
    <script th:src="@{/js/sidebar-active.js}"></script>
  </body>
</html>
